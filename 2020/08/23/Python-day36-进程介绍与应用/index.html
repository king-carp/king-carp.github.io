<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Python day36:进程介绍与应用 | 王寄鱼's Blog</title><meta name="description" content="一、进程进程一个程序的运行过程 创建进程123Windows：CreateProcessLinux：fork  进程终止1.正常运行结束 2.被其他进程终结 123456789101112131415161718192021# Windows下查看端口和杀死进程查看占用端口号的进程号：netstat –ano | findstr &quot;指定端口号&quot;通过进程号杀死进程：taskkil"><meta name="keywords" content="Python"><meta name="author" content="王寄鱼"><meta name="copyright" content="王寄鱼"><meta name="format-detection" content="telephone=no"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="http://yoursite.com/2020/08/23/Python-day36-%E8%BF%9B%E7%A8%8B%E4%BB%8B%E7%BB%8D%E4%B8%8E%E5%BA%94%E7%94%A8/"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//fonts.googleapis.com" crossorigin="crossorigin"/><meta property="og:type" content="article"><meta property="og:title" content="Python day36:进程介绍与应用"><meta property="og:url" content="http://yoursite.com/2020/08/23/Python-day36-%E8%BF%9B%E7%A8%8B%E4%BB%8B%E7%BB%8D%E4%B8%8E%E5%BA%94%E7%94%A8/"><meta property="og:site_name" content="王寄鱼's Blog"><meta property="og:description" content="一、进程进程一个程序的运行过程 创建进程123Windows：CreateProcessLinux：fork  进程终止1.正常运行结束 2.被其他进程终结 123456789101112131415161718192021# Windows下查看端口和杀死进程查看占用端口号的进程号：netstat –ano | findstr &quot;指定端口号&quot;通过进程号杀死进程：taskkil"><meta property="og:image" content="https://s1.ax1x.com/2020/08/09/a7SlNt.jpg"><meta property="article:published_time" content="2020-08-23T03:09:11.480Z"><meta property="article:modified_time" content="2020-08-23T23:21:07.431Z"><meta name="twitter:card" content="summary"><script>var activateDarkMode = function () {
  document.documentElement.setAttribute('data-theme', 'dark')
  if (document.querySelector('meta[name="theme-color"]') !== null) {
    document.querySelector('meta[name="theme-color"]').setAttribute('content', '#000')
  }
}
var activateLightMode = function () {
  document.documentElement.setAttribute('data-theme', 'light')
  if (document.querySelector('meta[name="theme-color"]') !== null) {
    document.querySelector('meta[name="theme-color"]').setAttribute('content', '#fff')
  }
}

var getCookies = function (name) {
  const value = `; ${document.cookie}`
  const parts = value.split(`; ${name}=`)
  if (parts.length === 2) return parts.pop().split(';').shift()
}

var autoChangeMode = 'false'
var t = getCookies('theme')
if (autoChangeMode === '1') {
  var isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches
  var isLightMode = window.matchMedia('(prefers-color-scheme: light)').matches
  var isNotSpecified = window.matchMedia('(prefers-color-scheme: no-preference)').matches
  var hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

  if (t === undefined) {
    if (isLightMode) activateLightMode()
    else if (isDarkMode) activateDarkMode()
    else if (isNotSpecified || hasNoSupport) {
      console.log('You specified no preference for a color scheme or your browser does not support it. I Schedule dark mode during night time.')
      var now = new Date()
      var hour = now.getHours()
      var isNight = hour <= 6 || hour >= 18
      isNight ? activateDarkMode() : activateLightMode()
    }
    window.matchMedia('(prefers-color-scheme: dark)').addListener(function (e) {
      if (Cookies.get('theme') === undefined) {
        e.matches ? activateDarkMode() : activateLightMode()
      }
    })
  } else if (t === 'light') activateLightMode()
  else activateDarkMode()
} else if (autoChangeMode === '2') {
  now = new Date()
  hour = now.getHours()
  isNight = hour <= 6 || hour >= 18
  if (t === undefined) isNight ? activateDarkMode() : activateLightMode()
  else if (t === 'light') activateLightMode()
  else activateDarkMode()
} else {
  if (t === 'dark') activateDarkMode()
  else if (t === 'light') activateLightMode()
}</script><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Titillium+Web&amp;display=swap"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"簡"},
  noticeOutdate: undefined,
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  bookmark: {
    message_prev: '按',
    message_next: '键将本页加入书签'
  },
  runtime_unit: '天',
  runtime: true,
  copyright: {"limitCount":50,"languages":{"author":"作者: 王寄鱼","link":"链接: ","source":"来源: 王寄鱼's Blog","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。"}},
  ClickShowText: {"text":"富强,民主,文明,和谐,自由,平等,公平,法治,爱国,敬业,诚信,友善","fontSize":"15px"},
  medium_zoom: false,
  fancybox: true,
  Snackbar: undefined,
  justifiedGallery: {
    js: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/js/jquery.justifiedGallery.min.js',
    css: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/css/justifiedGallery.min.css'
  },
  baiduPush: false,
  highlightCopy: true,
  highlightLang: true,
  isPhotoFigcaption: false,
  islazyload: true,
  isanchor: false    
}</script><script id="config_change">var GLOBAL_CONFIG_SITE = { 
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isSidebar: true,
  postUpdate: '2020-08-24 07:21:07'
}</script><noscript><style>
#nav {
  opacity: 1
}
.justified-gallery img {
  opacity: 1
}
</style></noscript><meta name="generator" content="Hexo 5.0.0"></head><body><div id="mobile-sidebar"><div id="menu_mask"></div><div id="mobile-sidebar-menus"><div class="mobile_author_icon"><img class="avatar-img" data-lazy-src="https://s1.ax1x.com/2020/07/26/aCcVVe.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="mobile_post_data"><div class="mobile_data_item is-center"><div class="mobile_data_link"><a href="/archives/"><div class="headline">文章</div><div class="length_num">45</div></a></div></div><div class="mobile_data_item is-center">      <div class="mobile_data_link"><a href="/tags/"><div class="headline">标签</div><div class="length_num">2</div></a></div></div><div class="mobile_data_item is-center">     <div class="mobile_data_link"><a href="/categories/"><div class="headline">分类</div><div class="length_num">3</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首頁</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 時間軸</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 標籤</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分類</span></a></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw fa fa-heartbeat"></i><span> 清單</span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/music/"><i class="fa-fw fas fa-music"></i><span> 音樂</span></a></li><li><a class="site-page" href="/Gallery/"><i class="fa-fw fas fa-images"></i><span> 照片</span></a></li><li><a class="site-page" href="/movies/"><i class="fa-fw fas fa-video"></i><span> 電影</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友鏈</span></a></div></div></div></div><div id="body-wrap"><div id="sidebar"><i class="fas fa-arrow-right on" id="toggle-sidebar"></i><div class="sidebar-toc"><div class="sidebar-toc__title">目录</div><div class="sidebar-toc__progress"><span class="progress-notice">你已经读了</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar">     </div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%80%E3%80%81%E8%BF%9B%E7%A8%8B"><span class="toc-number">1.</span> <span class="toc-text">一、进程</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BF%9B%E7%A8%8B"><span class="toc-number">1.1.</span> <span class="toc-text">进程</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E8%BF%9B%E7%A8%8B"><span class="toc-number">1.2.</span> <span class="toc-text">创建进程</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BF%9B%E7%A8%8B%E7%BB%88%E6%AD%A2"><span class="toc-number">1.3.</span> <span class="toc-text">进程终止</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%90%8C%E6%AD%A5%E3%80%81%E5%BC%82%E6%AD%A5%E3%80%81%E9%98%BB%E5%A1%9E%E3%80%81%E9%9D%9E%E9%98%BB%E5%A1%9E"><span class="toc-number">1.4.</span> <span class="toc-text">同步、异步、阻塞、非阻塞***</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%90%8C%E6%AD%A5"><span class="toc-number">1.4.1.</span> <span class="toc-text">同步</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%BC%82%E6%AD%A5"><span class="toc-number">1.4.2.</span> <span class="toc-text">异步</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%98%BB%E5%A1%9E"><span class="toc-number">1.4.3.</span> <span class="toc-text">阻塞</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%9D%9E%E9%98%BB%E5%A1%9E"><span class="toc-number">1.4.4.</span> <span class="toc-text">非阻塞</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%8C%E3%80%81%E8%BF%9B%E7%A8%8B%E5%BA%94%E7%94%A8"><span class="toc-number">2.</span> <span class="toc-text">二、进程应用</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E5%BD%93%E5%89%8D%E8%BF%9B%E7%A8%8Bid%E5%8F%B7"><span class="toc-number">2.1.</span> <span class="toc-text">获取当前进程id号</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#multiprocessing%E6%A8%A1%E5%9D%97"><span class="toc-number">2.2.</span> <span class="toc-text">multiprocessing模块</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Process%E7%B1%BB%E4%BB%8B%E7%BB%8D"><span class="toc-number">2.3.</span> <span class="toc-text">Process类介绍</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%96%B9%E6%B3%95%E4%BB%8B%E7%BB%8D"><span class="toc-number">2.4.</span> <span class="toc-text">方法介绍</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B1%9E%E6%80%A7%E4%BB%8B%E7%BB%8D"><span class="toc-number">2.5.</span> <span class="toc-text">属性介绍</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Process%E7%B1%BB%E4%BD%BF%E7%94%A8"><span class="toc-number">2.6.</span> <span class="toc-text">Process类使用</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E5%B9%B6%E5%BC%80%E5%90%AF%E5%AD%90%E8%BF%9B%E7%A8%8B-%E6%96%B9%E6%B3%951"><span class="toc-number">2.6.1.</span> <span class="toc-text">创建并开启子进程(方法1)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E5%B9%B6%E5%BC%80%E5%90%AF%E5%AD%90%E8%BF%9B%E7%A8%8B-%E6%96%B9%E6%B3%952"><span class="toc-number">2.6.2.</span> <span class="toc-text">创建并开启子进程(方法2)</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#join%E6%96%B9%E6%B3%95"><span class="toc-number">2.7.</span> <span class="toc-text">join方法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%83%B5%E5%B0%B8%E8%BF%9B%E7%A8%8B%E4%B8%8E%E5%AD%A4%E5%84%BF%E8%BF%9B%E7%A8%8B-%E4%BA%86%E8%A7%A3"><span class="toc-number">2.8.</span> <span class="toc-text">僵尸进程与孤儿进程(了解)</span></a></li></ol></li></ol></div></div></div><header class="post-bg" id="page-header" style="background-image: url(https://s1.ax1x.com/2020/08/09/a7SlNt.jpg)"><nav id="nav"><span class="pull-left" id="blog_name"><a class="blog_title" id="site-name" href="/">王寄鱼's Blog</a></span><span class="pull-right menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首頁</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 時間軸</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 標籤</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分類</span></a></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw fa fa-heartbeat"></i><span> 清單</span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/music/"><i class="fa-fw fas fa-music"></i><span> 音樂</span></a></li><li><a class="site-page" href="/Gallery/"><i class="fa-fw fas fa-images"></i><span> 照片</span></a></li><li><a class="site-page" href="/movies/"><i class="fa-fw fas fa-video"></i><span> 電影</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友鏈</span></a></div></div><span class="toggle-menu close"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></span></span></nav><div id="post-info"><div id="post-title"><div class="posttitle">Python day36:进程介绍与应用</div></div><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2020-08-23T03:09:11.480Z" title="发表于 2020-08-23 11:09:11">2020-08-23</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2020-08-23T23:21:07.431Z" title="更新于 2020-08-24 07:21:07">2020-08-24</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/Python%E5%AD%A6%E4%B9%A0/">Python学习</a></span></div><div class="meta-secondline"> <span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">4.4k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>16分钟</span></span></div></div></div></header><main class="layout_post" id="content-inner"><article id="post"><div class="post-content" id="article-container"><h2 id="一、进程"><a href="#一、进程" class="headerlink" title="一、进程"></a>一、进程</h2><h3 id="进程"><a href="#进程" class="headerlink" title="进程"></a>进程</h3><p>一个程序的运行过程</p>
<h3 id="创建进程"><a href="#创建进程" class="headerlink" title="创建进程"></a>创建进程</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Windows：CreateProcess</span><br><span class="line"></span><br><span class="line">Linux：fork</span><br></pre></td></tr></table></figure>

<h3 id="进程终止"><a href="#进程终止" class="headerlink" title="进程终止"></a>进程终止</h3><p>1.正常运行结束</p>
<p>2.被其他进程终结</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Windows下查看端口和杀死进程</span></span><br><span class="line">查看占用端口号的进程号：netstat –ano | findstr <span class="string">&quot;指定端口号&quot;</span></span><br><span class="line">通过进程号杀死进程：taskkill /pid 进程号</span><br><span class="line">通过进程号强制杀死进程：taskkill /f /pid 进程号</span><br><span class="line">通过进程号查看进程 tasklist | findstr <span class="string">&quot;进程号&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Linux下查看端口和杀死进程</span></span><br><span class="line">Linux下查看端口号所使用的进程号：netstat -anp|grep port</span><br><span class="line">Linux杀死进程:kill <span class="number">-9</span> PID</span><br><span class="line">Linux下还提供了一个killall命令，可以直接使用进程的名字而不是进程标识号，例如： killall <span class="number">-9</span> name</span><br><span class="line"><span class="comment"># Linux通过端口号查看进程号</span></span><br><span class="line">查看程序对应进程号：ps -ef | grep 进程名</span><br><span class="line">查看进程号所占用的端口号:</span><br><span class="line">REDHAT: netstat -nltp|grep pid</span><br><span class="line">ubuntu: netstat -anp|grep pid</span><br><span class="line">  </span><br><span class="line"><span class="comment"># Mac下查看端口和杀死进程,部分情况下需要管理员权限需要加上sudo</span></span><br><span class="line">Mac下使用lsof（list open files）来查看端口占用情况，lsof 是一个列出当前系统打开文件的工具。</span><br><span class="line">使用 -i 查看某个端口是否被占用，如：lsof -i:<span class="number">3000</span></span><br><span class="line">如果端口被占用，则会返回相关信息，如果没被占用，则不返回任何信息。</span><br><span class="line">杀死进程:kill <span class="number">-9</span> PID</span><br></pre></td></tr></table></figure>

<h3 id="同步、异步、阻塞、非阻塞"><a href="#同步、异步、阻塞、非阻塞" class="headerlink" title="同步、异步、阻塞、非阻塞***"></a>同步、异步、阻塞、非阻塞***</h3><p>进程运行的三种状态，其中运行态与就绪态又称为非阻塞态。(运行态,就绪态)非阻塞态,阻塞态</p>
<p>调用任务的两种方式：同步调用、异步调用</p>
<p>同步调用：提交完任务后，就在原地等待任务执行完毕，拿到运行结果/返回值后再执行下一步，同步调用下任务是串行执行。</p>
<p>异步调用：提交完任务后，不会再原地等待任务执行完毕，直接执行下一行代码，异步调用时并发执行。异步调用，几乎同时下达任务</p>
<p>通过下列代码可以看出同步与异步的区别</p>
<h4 id="同步"><a href="#同步" class="headerlink" title="同步"></a>同步</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 同步调用</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">task</span>(<span class="params">x</span>):</span></span><br><span class="line">    print(<span class="string">&quot;%s is running&quot;</span> % os.getpid())</span><br><span class="line">    time.sleep(random.randint(<span class="number">1</span>,<span class="number">3</span>))</span><br><span class="line">    <span class="keyword">return</span> x**<span class="number">2</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">if</span> __name__==<span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    p = ProcessPoolExecutor()</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">10</span>):</span><br><span class="line">        res = p.submit(task,i).result()<span class="comment">#返回计算结果</span></span><br><span class="line">        print(res)</span><br><span class="line">    print(<span class="string">&quot;主&quot;</span>)</span><br><span class="line">   </span><br><span class="line">-------------------------------------------------</span><br><span class="line"><span class="number">8360</span> <span class="keyword">is</span> running</span><br><span class="line"><span class="number">0</span></span><br><span class="line"><span class="number">472</span> <span class="keyword">is</span> running</span><br><span class="line"><span class="number">1</span></span><br><span class="line"><span class="number">4888</span> <span class="keyword">is</span> running</span><br><span class="line"><span class="number">4</span></span><br><span class="line"><span class="number">12980</span> <span class="keyword">is</span> running</span><br><span class="line"><span class="number">9</span></span><br><span class="line"><span class="number">8360</span> <span class="keyword">is</span> running</span><br><span class="line"><span class="number">16</span></span><br><span class="line"><span class="number">472</span> <span class="keyword">is</span> running</span><br><span class="line"><span class="number">25</span></span><br><span class="line"><span class="number">4888</span> <span class="keyword">is</span> running</span><br><span class="line"><span class="number">36</span></span><br><span class="line"><span class="number">12980</span> <span class="keyword">is</span> running</span><br><span class="line"><span class="number">49</span></span><br><span class="line"><span class="number">8360</span> <span class="keyword">is</span> running</span><br><span class="line"><span class="number">64</span></span><br><span class="line"><span class="number">472</span> <span class="keyword">is</span> running</span><br><span class="line"><span class="number">81</span></span><br><span class="line">主</span><br></pre></td></tr></table></figure>
<h4 id="异步"><a href="#异步" class="headerlink" title="异步"></a>异步</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 异步调用</span></span><br><span class="line"><span class="keyword">from</span> concurrent.futures <span class="keyword">import</span> ProcessPoolExecutor</span><br><span class="line"><span class="keyword">import</span> os, time,random</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">task</span>(<span class="params">x</span>):</span></span><br><span class="line">    print(<span class="string">&quot;%s is running&quot;</span> % os.getpid())</span><br><span class="line">    time.sleep(random.randint(<span class="number">1</span>,<span class="number">3</span>))</span><br><span class="line">    <span class="keyword">return</span> x**<span class="number">2</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__==<span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    p = ProcessPoolExecutor()</span><br><span class="line">    futures = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">10</span>):</span><br><span class="line">        future = p.submit(task,i)<span class="comment">#返回计算结果</span></span><br><span class="line">        futures.append(future)</span><br><span class="line">    p.shutdown(wait=<span class="literal">True</span>)<span class="comment">#默认waiti为True 等待十个进程任务执行完，关闭进程池的入口。</span></span><br><span class="line">    <span class="keyword">for</span> future <span class="keyword">in</span> futures:</span><br><span class="line">        print(future.result())</span><br><span class="line">    print(<span class="string">&quot;主&quot;</span>)</span><br><span class="line"></span><br><span class="line">------------------------------------------------</span><br><span class="line"><span class="number">10760</span> <span class="keyword">is</span> running</span><br><span class="line"><span class="number">10564</span> <span class="keyword">is</span> running</span><br><span class="line"><span class="number">12848</span> <span class="keyword">is</span> running</span><br><span class="line"><span class="number">3928</span> <span class="keyword">is</span> running</span><br><span class="line"><span class="number">10564</span> <span class="keyword">is</span> running</span><br><span class="line"><span class="number">12848</span> <span class="keyword">is</span> running</span><br><span class="line"><span class="number">10760</span> <span class="keyword">is</span> running</span><br><span class="line"><span class="number">3928</span> <span class="keyword">is</span> running</span><br><span class="line"><span class="number">10760</span> <span class="keyword">is</span> running</span><br><span class="line"><span class="number">10564</span> <span class="keyword">is</span> running</span><br><span class="line"><span class="number">0</span></span><br><span class="line"><span class="number">1</span></span><br><span class="line"><span class="number">4</span></span><br><span class="line"><span class="number">9</span></span><br><span class="line"><span class="number">16</span></span><br><span class="line"><span class="number">25</span></span><br><span class="line"><span class="number">36</span></span><br><span class="line"><span class="number">49</span></span><br><span class="line"><span class="number">64</span></span><br><span class="line"><span class="number">81</span></span><br><span class="line">主</span><br><span class="line">-----------------------------------------------</span><br><span class="line"><span class="comment"># 若将shutdown中的wait = True删除，则会出现结果出现在中间。</span></span><br><span class="line"><span class="number">2908</span> <span class="keyword">is</span> running</span><br><span class="line"><span class="number">8092</span> <span class="keyword">is</span> running</span><br><span class="line"><span class="number">10376</span> <span class="keyword">is</span> running</span><br><span class="line"><span class="number">13136</span> <span class="keyword">is</span> running</span><br><span class="line"><span class="number">8092</span> <span class="keyword">is</span> running</span><br><span class="line"><span class="number">2908</span> <span class="keyword">is</span> running</span><br><span class="line"><span class="number">0</span></span><br><span class="line"><span class="number">1</span></span><br><span class="line"><span class="number">8092</span> <span class="keyword">is</span> running</span><br><span class="line"><span class="number">10376</span> <span class="keyword">is</span> running</span><br><span class="line"><span class="number">4</span></span><br><span class="line"><span class="number">2908</span> <span class="keyword">is</span> running</span><br><span class="line"><span class="number">10376</span> <span class="keyword">is</span> running</span><br><span class="line"><span class="number">9</span></span><br><span class="line"><span class="number">16</span></span><br><span class="line"><span class="number">25</span></span><br><span class="line"><span class="number">36</span></span><br><span class="line"><span class="number">49</span></span><br><span class="line"><span class="number">64</span></span><br><span class="line"><span class="number">81</span></span><br><span class="line">主</span><br></pre></td></tr></table></figure>

<h4 id="阻塞"><a href="#阻塞" class="headerlink" title="阻塞"></a>阻塞</h4><p>阻塞调用是指调用结果返回之前，当前线程会被挂起（如遇到io操作）。函数只有在得到结果之后才会将阻塞的线程激活。有人也许会把阻塞调用和同步调用等同起来，实际上他是不同的。对于同步调用来说，很多时候当前线程还是激活的，只是从逻辑上当前函数没有返回而已。</p>
<h4 id="非阻塞"><a href="#非阻塞" class="headerlink" title="非阻塞"></a>非阻塞</h4><p>非阻塞和阻塞的概念相对应，指在不能立刻得到结果之前也会立刻返回，同时该函数不会阻塞当前线程</p>
<h2 id="二、进程应用"><a href="#二、进程应用" class="headerlink" title="二、进程应用"></a>二、进程应用</h2><h3 id="获取当前进程id号"><a href="#获取当前进程id号" class="headerlink" title="获取当前进程id号"></a>获取当前进程id号</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line">print(os.getpid())</span><br><span class="line">time.sleep(<span class="number">60</span>)</span><br></pre></td></tr></table></figure>

<h3 id="multiprocessing模块"><a href="#multiprocessing模块" class="headerlink" title="multiprocessing模块"></a>multiprocessing模块</h3><p>python中的多线程无法利用多核优势，如果想要充分地使用多核CPU的资源（可通过os.cpu_count()查看），在python中大部分情况需要使用多进程。Python提供了multiprocessing。 multiprocessing模块用来开启子进程，并在子进程中执行我们定制的任务（比如函数），该模块与多线程模块threading的编程接口类似。multiprocessing模块的功能众多：支持子进程、通信和共享数据、执行不同形式的同步，提供了Process、Queue、Pipe、Lock等组件。<strong>需要再次强调的一点是</strong>：与线程不同，进程没有任何共享状态（存在物理隔离），进程修改的数据，改动仅限于该进程内。</p>
<h3 id="Process类介绍"><a href="#Process类介绍" class="headerlink" title="Process类介绍"></a>Process类介绍</h3><p>创建进程的类</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">Process([group [, target [, name [, args [, kwargs]]]]])</span><br><span class="line"><span class="comment"># 由该类实例化得到的对象，表示一个子进程中的任务（尚未启动）</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">强调：</span></span><br><span class="line"><span class="string">1. 需要使用关键字的方式来指定参数</span></span><br><span class="line"><span class="string">2. args指定的为传给target函数的位置参数，是一个元组形式，必须有逗号</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">参数介绍</span></span><br><span class="line"><span class="string">group参数未使用，值始终为None</span></span><br><span class="line"><span class="string">target表示调用对象，即子进程要执行的任务</span></span><br><span class="line"><span class="string">args表示调用对象的位置参数元组，args=(1,2,&#x27;yang&#x27;,)</span></span><br><span class="line"><span class="string">kwargs表示调用对象的字典,kwargs=&#123;&#x27;name&#x27;:&#x27;yang&#x27;,&#x27;age&#x27;:18&#125;</span></span><br><span class="line"><span class="string">name为子进程的名称</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure>

<h3 id="方法介绍"><a href="#方法介绍" class="headerlink" title="方法介绍"></a>方法介绍</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">Process.start()  <span class="comment"># 启动进程，并调用该子进程中的p.run() </span></span><br><span class="line">Process.run()  <span class="comment"># 进程启动时运行的方法，正是它去调用target指定的函数，我们自定义类的类中一定要实现该方法  </span></span><br><span class="line"></span><br><span class="line">Process.terminate()</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">强制终止进程p，不会进行任何清理操作，如果p创建了子进程，该子进程就成了僵尸进程，使用该方法需要特别小心这种情况。如果p还保存了一个锁那么也将不会被释放，进而导致死锁</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">Process.is_alive()  <span class="comment"># 如果p仍然运行，返回True</span></span><br><span class="line">Process.join([timeout])</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">主线程等待p终止（强调：是主线程处于等的状态，而p是处于运行的状态）。timeout是可选的超时时间，需要强调的是，p.join只能join住start开启的进程，而不能join住run开启的进程</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure>

<h3 id="属性介绍"><a href="#属性介绍" class="headerlink" title="属性介绍"></a>属性介绍</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">Process.daemon</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">默认值为False，如果设为True，代表p为后台运行的守护进程，当p的父进程终止时，p也随之终止，并且设定为True后，p不能创建自己的新进程，必须在p.start()之前设置</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">Process.name  <span class="comment"># 进程的名称</span></span><br><span class="line">Process.pid  <span class="comment"># 进程的pid</span></span><br><span class="line">Process.exitcode  <span class="comment"># 进程在运行时为None、如果为–N，表示被信号N结束(了解即可)</span></span><br><span class="line">Process.authkey</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">进程的身份验证键,默认是由os.urandom()随机生成的32字符的字符串。这个键的用途是为涉及网络连接的底层进程间通信提供安全性，这类连接只有在具有相同的身份验证键时才能成功（了解即可）</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure>

<h3 id="Process类使用"><a href="#Process类使用" class="headerlink" title="Process类使用"></a>Process类使用</h3><p><strong>注意：在windows中Process()必须放到if__name__== __main__:下</strong></p>
<h4 id="创建并开启子进程-方法1"><a href="#创建并开启子进程-方法1" class="headerlink" title="创建并开启子进程(方法1)"></a>创建并开启子进程(方法1)</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">from</span> multiprocessing <span class="keyword">import</span> Process</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">task</span>(<span class="params">n, tag</span>):</span></span><br><span class="line">    print(<span class="string">&quot;%s is running&quot;</span> % tag)</span><br><span class="line">    time.sleep(<span class="number">5</span>)</span><br><span class="line">    print(<span class="string">&quot;%s is done&quot;</span> % tag)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    p1 = Process(target=task, args=(<span class="number">5</span>, <span class="string">&quot;子进程1&quot;</span>))</span><br><span class="line">    p2 = Process(target=task, args=(<span class="number">3</span>, <span class="string">&quot;子进程2&quot;</span>))</span><br><span class="line">    p3 = Process(target=task, args=(<span class="number">2</span>, <span class="string">&quot;子进程3&quot;</span>))</span><br><span class="line">    p1.start()</span><br><span class="line">    p2.start()</span><br><span class="line">    p3.start()</span><br><span class="line">    print(<span class="string">&quot;主:%s。。。&quot;</span> % os.getpid())</span><br></pre></td></tr></table></figure>

<h4 id="创建并开启子进程-方法2"><a href="#创建并开启子进程-方法2" class="headerlink" title="创建并开启子进程(方法2)"></a>创建并开启子进程(方法2)</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">from</span> multiprocessing <span class="keyword">import</span> Process</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Myprocess</span>(<span class="params">Process</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self,tag</span>):</span></span><br><span class="line">        super().__init__()</span><br><span class="line">        self.tag = tag</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">run</span>(<span class="params">self</span>) -&gt; <span class="keyword">None</span>:</span></span><br><span class="line">        print(<span class="string">&quot;%s is running&quot;</span> % self.tag)</span><br><span class="line">        time.sleep(<span class="number">3</span>)</span><br><span class="line">        print(<span class="string">&quot;%s is done&quot;</span> % self.tag)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    p1 = Myprocess(<span class="string">&quot;进程1&quot;</span>)</span><br><span class="line">    p2 = Myprocess(<span class="string">&quot;进程2&quot;</span>)</span><br><span class="line">    p3 = Myprocess(<span class="string">&quot;进程3&quot;</span>)</span><br><span class="line">    p1.start()  <span class="comment"># p1.run()</span></span><br><span class="line">    p2.start()  <span class="comment"># p2.run()</span></span><br><span class="line">    p3.start()  <span class="comment"># p3.run()</span></span><br><span class="line">    print(<span class="string">&quot;主:%s。。。&quot;</span> % os.getpid())</span><br></pre></td></tr></table></figure>

<h3 id="join方法"><a href="#join方法" class="headerlink" title="join方法"></a>join方法</h3><p>在很多情况下，主线程创建并启动子线程，如果子线程中要进行大量的耗时运算，主线程将早于子线程结束。这时，如果主线程想等子线程执行完成才结束，比如子线程处理一个数据，主线程想要获得这个数据中的值，就要用到join()方法了。方法join()的作用是等待线程对象销毁。</p>
<p>　　<strong>join方法的主要作用就是同步，它可以使得线程之间的并行执行变为串行执行。在A线程中调用了B线程的join()方法时，表示只有当B线程执行完毕时，A线程才能继续执行。<br>　　join方法中如果传入参数，则表示这样的意思：如果A线程中掉用B线程的join(10)，则表示A线程会等待B线程执行10毫秒，10毫秒过后，A、B线程并行执行。需要注意的是，jdk规定，join(0)的意思不是A线程等待B线程0秒，而是A线程等待B线程无限时间，直到B线程执行完毕，即join(0)等价于join()。(其实join()中调用的是join(0))<br>　　join方法必须在线程start方法调用之后调用才有意义。这个也很容易理解：如果一个线程都没有start，那它也就无法同步了。</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">from</span> multiprocessing <span class="keyword">import</span> Process</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">task</span>(<span class="params">n, tag</span>):</span></span><br><span class="line">    print(<span class="string">&quot;%s is running&quot;</span> % tag)</span><br><span class="line">    time.sleep(n)</span><br><span class="line">    print(<span class="string">&quot;%s is done&quot;</span> % tag)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    p1 = Process(target=task, args=(<span class="number">3</span>, <span class="string">&quot;子进程1&quot;</span>))</span><br><span class="line">    p2 = Process(target=task, args=(<span class="number">4</span>, <span class="string">&quot;子进程2&quot;</span>))</span><br><span class="line">    p3 = Process(target=task, args=(<span class="number">5</span>, <span class="string">&quot;子进程3&quot;</span>))</span><br><span class="line"></span><br><span class="line">    start=time.time()</span><br><span class="line">    p1.start()</span><br><span class="line">    p2.start()</span><br><span class="line">    p3.start()</span><br><span class="line"></span><br><span class="line">    p1.join()</span><br><span class="line">    p3.join()</span><br><span class="line">    p2.join()</span><br><span class="line"></span><br><span class="line">    print(p1.pid)</span><br><span class="line">    print(p2.pid)</span><br><span class="line">    print(p3.pid)</span><br><span class="line"></span><br><span class="line">    print(time.time() - start)</span><br><span class="line">    print(<span class="string">&quot;主:%s。。。&quot;</span> % os.getpid())</span><br></pre></td></tr></table></figure>

<h3 id="僵尸进程与孤儿进程-了解"><a href="#僵尸进程与孤儿进程-了解" class="headerlink" title="僵尸进程与孤儿进程(了解)"></a>僵尸进程与孤儿进程(了解)</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br></pre></td><td class="code"><pre><span class="line">参考博客：http://www.cnblogs.com/Anker/p/<span class="number">3271773.</span>html</span><br><span class="line"></span><br><span class="line">一：僵尸进程（有害）</span><br><span class="line">　　僵尸进程：一个进程使用fork创建子进程，如果子进程退出，而父进程并没有调用wait或waitpid获取子进程的状态信息，那么子进程的进程描述符仍然保存在系统中。这种进程称之为僵死进程。详解如下</span><br><span class="line"></span><br><span class="line">我们知道在unix/linux中，正常情况下子进程是通过父进程创建的，子进程在创建新的进程。子进程的结束和父进程的运行是一个异步过程,即父进程永远无法预测子进程到底什么时候结束，如果子进程一结束就立刻回收其全部资源，那么在父进程内将无法获取子进程的状态信息。</span><br><span class="line"></span><br><span class="line">因此，UNⅨ提供了一种机制可以保证父进程可以在任意时刻获取子进程结束时的状态信息：</span><br><span class="line"><span class="number">1</span>、在每个进程退出的时候，内核释放该进程所有的资源，包括打开的文件，占用的内存等。但是仍然为其保留一定的信息（包括进程号the process ID，退出状态the termination status of the process，运行时间the amount of CPU time taken by the process等）</span><br><span class="line"><span class="number">2</span>、直到父进程通过wait / waitpid来取时才释放. 但这样就导致了问题，如果进程不调用wait / waitpid的话，那么保留的那段信息就不会释放，其进程号就会一直被占用，但是系统所能使用的进程号是有限的，如果大量的产生僵死进程，将因为没有可用的进程号而导致系统不能产生新的进程. 此即为僵尸进程的危害，应当避免。</span><br><span class="line"></span><br><span class="line">　　任何一个子进程(init除外)在exit()之后，并非马上就消失掉，而是留下一个称为僵尸进程(Zombie)的数据结构，等待父进程处理。这是每个子进程在结束时都要经过的阶段。如果子进程在exit()之后，父进程没有来得及处理，这时用ps命令就能看到子进程的状态是“Z”。如果父进程能及时 处理，可能用ps命令就来不及看到子进程的僵尸状态，但这并不等于子进程不经过僵尸状态。  如果父进程在子进程结束之前退出，则子进程将由init接管。init将会以父进程的身份对僵尸状态的子进程进行处理。</span><br><span class="line"></span><br><span class="line">二：孤儿进程（无害）</span><br><span class="line"></span><br><span class="line">　　孤儿进程：一个父进程退出，而它的一个或多个子进程还在运行，那么那些子进程将成为孤儿进程。孤儿进程将被init进程(进程号为<span class="number">1</span>)所收养，并由init进程对它们完成状态收集工作。</span><br><span class="line"></span><br><span class="line">　　孤儿进程是没有父进程的进程，孤儿进程这个重任就落到了init进程身上，init进程就好像是一个民政局，专门负责处理孤儿进程的善后工作。每当出现一个孤儿进程的时候，内核就把孤 儿进程的父进程设置为init，而init进程会循环地wait()它的已经退出的子进程。这样，当一个孤儿进程凄凉地结束了其生命周期的时候，init进程就会代表党和政府出面处理它的一切善后工作。因此孤儿进程并不会有什么危害。</span><br><span class="line"></span><br><span class="line">我们来测试一下（创建完子进程后，主进程所在的这个脚本就退出了，当父进程先于子进程结束时，子进程会被init收养，成为孤儿进程，而非僵尸进程），文件内容</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line">pid = os.getpid()</span><br><span class="line">ppid = os.getppid()</span><br><span class="line"><span class="keyword">print</span> <span class="string">&#x27;im father&#x27;</span>, <span class="string">&#x27;pid&#x27;</span>, pid, <span class="string">&#x27;ppid&#x27;</span>, ppid</span><br><span class="line">pid = os.fork()</span><br><span class="line"><span class="comment">#执行pid=os.fork()则会生成一个子进程</span></span><br><span class="line"><span class="comment">#返回值pid有两种值：</span></span><br><span class="line"><span class="comment">#    如果返回的pid值为0，表示在子进程当中</span></span><br><span class="line"><span class="comment">#    如果返回的pid值&gt;0，表示在父进程当中</span></span><br><span class="line"><span class="keyword">if</span> pid &gt; <span class="number">0</span>:</span><br><span class="line">    <span class="keyword">print</span> <span class="string">&#x27;father died..&#x27;</span></span><br><span class="line">    sys.exit(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 保证主线程退出完毕</span></span><br><span class="line">time.sleep(<span class="number">1</span>)</span><br><span class="line"><span class="keyword">print</span> <span class="string">&#x27;im child&#x27;</span>, os.getpid(), os.getppid()</span><br><span class="line"></span><br><span class="line">执行文件，输出结果：</span><br><span class="line">im father pid <span class="number">32515</span> ppid <span class="number">32015</span></span><br><span class="line">father died..</span><br><span class="line">im child <span class="number">32516</span> <span class="number">1</span></span><br><span class="line"></span><br><span class="line">看，子进程已经被pid为<span class="number">1</span>的init进程接收了，所以僵尸进程在这种情况下是不存在的，存在只有孤儿进程而已，孤儿进程声明周期结束自然会被init来销毁。</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">三：僵尸进程危害场景：</span><br><span class="line"></span><br><span class="line">　　例如有个进程，它定期的产 生一个子进程，这个子进程需要做的事情很少，做完它该做的事情之后就退出了，因此这个子进程的生命周期很短，但是，父进程只管生成新的子进程，至于子进程 退出之后的事情，则一概不闻不问，这样，系统运行上一段时间之后，系统中就会存在很多的僵死进程，倘若用ps命令查看的话，就会看到很多状态为Z的进程。 严格地来说，僵死进程并不是问题的根源，罪魁祸首是产生出大量僵死进程的那个父进程。因此，当我们寻求如何消灭系统中大量的僵死进程时，答案就是把产生大 量僵死进程的那个元凶枪毙掉（也就是通过kill发送SIGTERM或者SIGKILL信号啦）。枪毙了元凶进程之后，它产生的僵死进程就变成了孤儿进 程，这些孤儿进程会被init进程接管，init进程会wait()这些孤儿进程，释放它们占用的系统进程表中的资源，这样，这些已经僵死的孤儿进程 就能瞑目而去了。</span><br><span class="line"></span><br><span class="line">四：测试</span><br><span class="line"><span class="comment">#1、产生僵尸进程的程序test.py内容如下</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#coding:utf-8</span></span><br><span class="line"><span class="keyword">from</span> multiprocessing <span class="keyword">import</span> Process</span><br><span class="line"><span class="keyword">import</span> time,os</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">run</span>():</span></span><br><span class="line">    print(<span class="string">&#x27;子&#x27;</span>,os.getpid())</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    p=Process(target=run)</span><br><span class="line">    p.start()</span><br><span class="line"></span><br><span class="line">    print(<span class="string">&#x27;主&#x27;</span>,os.getpid())</span><br><span class="line">    time.sleep(<span class="number">1000</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#2、在unix或linux系统上执行</span></span><br><span class="line">[root@vm172<span class="number">-31</span><span class="number">-0</span><span class="number">-19</span> ~]<span class="comment"># python3  test.py &amp;</span></span><br><span class="line">[<span class="number">1</span>] <span class="number">18652</span></span><br><span class="line">[root@vm172<span class="number">-31</span><span class="number">-0</span><span class="number">-19</span> ~]<span class="comment"># 主 18652</span></span><br><span class="line">子 <span class="number">18653</span></span><br><span class="line"></span><br><span class="line">[root@vm172<span class="number">-31</span><span class="number">-0</span><span class="number">-19</span> ~]<span class="comment"># ps aux |grep Z</span></span><br><span class="line">USER       PID %CPU %MEM    VSZ   RSS TTY      STAT START   TIME COMMAND</span><br><span class="line">root     <span class="number">18653</span>  <span class="number">0.0</span>  <span class="number">0.0</span>      <span class="number">0</span>     <span class="number">0</span> pts/<span class="number">0</span>    Z    <span class="number">20</span>:<span class="number">02</span>   <span class="number">0</span>:<span class="number">00</span> [python3] &lt;defunct&gt; <span class="comment">#出现僵尸进程</span></span><br><span class="line">root     <span class="number">18656</span>  <span class="number">0.0</span>  <span class="number">0.0</span> <span class="number">112648</span>   <span class="number">952</span> pts/<span class="number">0</span>    S+   <span class="number">20</span>:<span class="number">02</span>   <span class="number">0</span>:<span class="number">00</span> grep --color=auto Z</span><br><span class="line"></span><br><span class="line">[root@vm172<span class="number">-31</span><span class="number">-0</span><span class="number">-19</span> ~]<span class="comment"># top #执行top命令发现1zombie</span></span><br><span class="line">top - <span class="number">20</span>:<span class="number">03</span>:<span class="number">42</span> up <span class="number">31</span> min,  <span class="number">3</span> users,  load average: <span class="number">0.01</span>, <span class="number">0.06</span>, <span class="number">0.12</span></span><br><span class="line">Tasks:  <span class="number">93</span> total,   <span class="number">2</span> running,  <span class="number">90</span> sleeping,   <span class="number">0</span> stopped,   <span class="number">1</span> zombie</span><br><span class="line">%Cpu(s):  <span class="number">0.0</span> us,  <span class="number">0.3</span> sy,  <span class="number">0.0</span> ni, <span class="number">99.7</span> id,  <span class="number">0.0</span> wa,  <span class="number">0.0</span> hi,  <span class="number">0.0</span> si,  <span class="number">0.0</span> st</span><br><span class="line">KiB Mem :  <span class="number">1016884</span> total,    <span class="number">97184</span> free,    <span class="number">70848</span> used,   <span class="number">848852</span> buff/cache</span><br><span class="line">KiB Swap:        <span class="number">0</span> total,        <span class="number">0</span> free,        <span class="number">0</span> used.   <span class="number">782540</span> avail Mem </span><br><span class="line"></span><br><span class="line">  PID USER      PR  NI    VIRT    RES    SHR S %CPU %MEM     TIME+ COMMAND                                                                                                                                        </span><br><span class="line">root      <span class="number">20</span>   <span class="number">0</span>   <span class="number">29788</span>   <span class="number">1256</span>    <span class="number">988</span> S  <span class="number">0.3</span>  <span class="number">0.1</span>   <span class="number">0</span>:<span class="number">01.50</span> elfin                                                                                                                      </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#3、</span></span><br><span class="line">等待父进程正常结束后会调用wait／waitpid去回收僵尸进程</span><br><span class="line">但如果父进程是一个死循环，永远不会结束，那么该僵尸进程就会一直存在，僵尸进程过多，就是有害的</span><br><span class="line">解决方法一：杀死父进程</span><br><span class="line">解决方法二：对开启的子进程应该记得使用join，join会回收僵尸进程</span><br><span class="line">参考python2源码注释</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Process</span>(<span class="params">object</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">join</span>(<span class="params">self, timeout=None</span>):</span></span><br><span class="line">        <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">        Wait until child process terminates</span></span><br><span class="line"><span class="string">        &#x27;&#x27;&#x27;</span></span><br><span class="line">        <span class="keyword">assert</span> self._parent_pid == os.getpid(), <span class="string">&#x27;can only join a child process&#x27;</span></span><br><span class="line">        <span class="keyword">assert</span> self._popen <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>, <span class="string">&#x27;can only join a started process&#x27;</span></span><br><span class="line">        res = self._popen.wait(timeout)</span><br><span class="line">        <span class="keyword">if</span> res <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">            _current_process._children.discard(self)</span><br><span class="line"></span><br><span class="line">join方法中调用了wait，告诉系统释放僵尸进程。discard为从自己的children中剔除</span><br><span class="line"></span><br><span class="line">解决方法三：http://blog.csdn.net/u010571844/article/details/<span class="number">50419798</span></span><br></pre></td></tr></table></figure>



</div><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">王寄鱼</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="http://yoursite.com/2020/08/23/Python-day36-%E8%BF%9B%E7%A8%8B%E4%BB%8B%E7%BB%8D%E4%B8%8E%E5%BA%94%E7%94%A8/">http://yoursite.com/2020/08/23/Python-day36-%E8%BF%9B%E7%A8%8B%E4%BB%8B%E7%BB%8D%E4%B8%8E%E5%BA%94%E7%94%A8/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://yoursite.com" target="_blank">王寄鱼's Blog</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/Python/">Python</a></div><div class="post_share"><div class="social-share" data-image="https://s1.ax1x.com/2020/08/09/a7SlNt.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2020/08/24/Python-day37-%E8%BF%9B%E7%A8%8B%E7%9B%B8%E5%85%B3/"><img class="prev-cover" data-lazy-src="https://s1.ax1x.com/2020/08/09/a7SlNt.jpg" onerror="onerror=null;src='/img/404.jpg'"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">Python day37:进程相关</div></div></a></div><div class="next-post pull-right"><a href="/2020/08/23/Python-day35-%E7%8C%B4%E5%AD%90%E8%A1%A5%E4%B8%81%E4%B8%8E%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6%E6%9C%BA%E5%88%B6%E4%B8%8E%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/"><img class="next-cover" data-lazy-src="https://s1.ax1x.com/2020/08/09/a7SlNt.jpg" onerror="onerror=null;src='/img/404.jpg'"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">Python day35:猴子补丁,垃圾回收机制,操作系统</div></div></a></div></nav><div class="relatedPosts"><div class="relatedPosts_headline"><i class="fas fa-thumbs-up fa-fw"></i><span> 相关推荐</span></div><div class="relatedPosts_list"><div class="relatedPosts_item"><a href="/2020/08/11/Python-day1-计算机硬件基础/" title="Python day1:计算机硬件基础"><img class="relatedPosts_cover" data-lazy-src="https://s1.ax1x.com/2020/08/09/a7SlNt.jpg"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="far fa-calendar-alt fa-fw"></i> 2020-08-11</div><div class="relatedPosts_title">Python day1:计算机硬件基础</div></div></a></div><div class="relatedPosts_item"><a href="/2020/08/11/Python-day10-文件处理/" title="Python day10:文件处理"><img class="relatedPosts_cover" data-lazy-src="https://s1.ax1x.com/2020/08/09/a7SlNt.jpg"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="far fa-calendar-alt fa-fw"></i> 2020-08-11</div><div class="relatedPosts_title">Python day10:文件处理</div></div></a></div><div class="relatedPosts_item"><a href="/2020/08/11/Python-day11-文件处理2/" title="Python day11:文件处理2"><img class="relatedPosts_cover" data-lazy-src="https://s1.ax1x.com/2020/08/09/a7SlNt.jpg"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="far fa-calendar-alt fa-fw"></i> 2020-08-11</div><div class="relatedPosts_title">Python day11:文件处理2</div></div></a></div><div class="relatedPosts_item"><a href="/2020/08/11/Python-day12-文件处理3+函数基础/" title="Python day12:文件处理3+函数基础"><img class="relatedPosts_cover" data-lazy-src="https://s1.ax1x.com/2020/08/09/a7SlNt.jpg"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="far fa-calendar-alt fa-fw"></i> 2020-08-11</div><div class="relatedPosts_title">Python day12:文件处理3+函数基础</div></div></a></div><div class="relatedPosts_item"><a href="/2020/08/11/Python-day13-函数基础2/" title="Python day13:函数基础2"><img class="relatedPosts_cover" data-lazy-src="https://s1.ax1x.com/2020/08/09/a7SlNt.jpg"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="far fa-calendar-alt fa-fw"></i> 2020-08-11</div><div class="relatedPosts_title">Python day13:函数基础2</div></div></a></div><div class="relatedPosts_item"><a href="/2020/08/11/Python-day14-闭包函数与装饰器/" title="Python day14:闭包函数与装饰器"><img class="relatedPosts_cover" data-lazy-src="https://s1.ax1x.com/2020/08/09/a7SlNt.jpg"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="far fa-calendar-alt fa-fw"></i> 2020-08-11</div><div class="relatedPosts_title">Python day14:闭包函数与装饰器</div></div></a></div></div></div><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div class="vcomment" id="vcomment"></div></div></div></div></article></main><footer id="footer" style="background-image: url(https://s1.ax1x.com/2020/08/09/a7SlNt.jpg)" data-type="photo"><div id="footer-wrap"><div class="copyright">&copy;2020 By 王寄鱼</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div><div class="footer_custom_text">逆水行舟,不进则退</div></div></footer></div><section id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="font_plus" type="button" title="放大字体"><i class="fas fa-plus"></i></button><button id="font_minus" type="button" title="缩小字体"><i class="fas fa-minus"></i></button><button id="translateLink" type="button" title="简繁转换">繁</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="chat_btn" type="button" title="rightside.chat_btn"><i class="fas fa-sms"></i></button><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></section><div><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page/instantpage.min.js" type="module" defer></script><script src="https://cdn.jsdelivr.net/npm/vanilla-lazyload/dist/lazyload.iife.min.js" async></script><div class="js-pjax"><script>function loadValine () {
  function initValine () {
    window.valine = new Valine({
      el: '#vcomment',
      appId: 'mhNShr1CKGIKtmIJFxImG6CR-gzGzoHsz',
      appKey: 'CUz06D7chSo4N0TpK8yCqlBh',
      placeholder: 'Please leave your footprints',
      avatar: 'monsterid',
      meta: 'nick,mail,link'.split(','),
      pageSize: '10',
      lang: 'en',
      recordIP: false,
      serverURLs: '',
      emojiCDN: '',
      emojiMaps: "",
      enableQQ: false,
      path: window.location.pathname,
    });
    if ('nick,mail') { valine.config.requiredFields= 'nick,mail'.split(',') }
  }

  if (typeof Valine === 'function') initValine() 
  else $.getScript('https://cdn.jsdelivr.net/npm/valine/dist/Valine.min.js', initValine)
}

if ('Valine' === 'Valine' || !false) {
  if (false) loadComment(document.querySelector('#vcomment'),loadValine)
  else setTimeout(() => loadValine(), 0)
} else {
  function loadOtherComment () {
    loadValine()
  }
}</script></div><script src="/js/third-party/activate-power-mode.js"></script><script>POWERMODE.colorful = true;
POWERMODE.shake = false;
document.body.addEventListener('input', POWERMODE);
</script><script src="/js/third-party/ClickShowText.js" async="async"></script></div><script type="text/javascript" src="/js/FunnyTitle.js"></script><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"log":false,"pluginJsPath":"lib/","pluginModelPath":"assets/","pluginRootPath":"live2dw/","tagMode":false});</script></body></html>